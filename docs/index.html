<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Video Annotation Tool</title>
  <link rel="stylesheet" href="./styles.css" />
  <meta name="description" content="Annotate videos with recorded audio notes, manage metadata, and export results—simple and fast." />
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">
        <img src="./assets/icon-64.png" alt="App icon" width="32" height="32" onerror="this.style.display='none'" />
        <h1>Video Annotation Tool</h1>
      </div>
      <div class="badge">Free • Open Source</div>
    </header>

    <section class="hero card">
      <h2>Download <span id="latestVersion" class="badge" style="margin-left:8px">checking…</span></h2>
      <p>Get the latest version for your computer. No coding or setup required.</p>
      <div class="actions">
        <a id="winInstaller" class="button primary" href="https://github.com/rulingAnts/videoannotationtool/releases/latest" target="_blank" rel="noopener">
          <span title="Installer: Adds shortcuts and Start Menu entry. Recommended for most users.">Windows Installer</span>
          <span class="small" title="Installer: Adds shortcuts and Start Menu entry. Recommended for most users, especially if you own the computer you're using.">(.exe)</span>
        </a>
        <a id="winPortable" class="button secondary" href="https://github.com/rulingAnts/videoannotationtool/releases/latest" target="_blank" rel="noopener">
          <span title="Portable: No installation, just unzip and run. No shortcuts or Start Menu entry.">Windows Portable</span>
          <span class="small" title="Portable: No installation, just download and run. No shortcuts or Start Menu entry. Can be run off of a thumb drive on public or shared computers that you do not own.">(.exe)</span>
        </a>
        <a id="macLink" class="button secondary" href="https://github.com/rulingAnts/videoannotationtool/releases/latest" target="_blank" rel="noopener" style="display:none;">
          <span>Download for macOS</span>
          <span class="small">(.dmg)</span>
        </a>
      </div>
      <div style="margin: 8px 0 0 0; color: var(--muted); font-size: 10px;">
        <strong>Tip:</strong> Use <b>Installer</b> if you own the computer (adds shortcuts and Start Menu entry). Use <b>Portable</b> if you don't own the computer or can't install software (no installation, just download and run).
      </div>
      <div style="margin: 8px 0 0 0; color: var(--muted); font-size: 10px;">
        If these buttons don’t start a download, open the <a href="https://github.com/rulingAnts/videoannotationtool/releases/latest" target="_blank" rel="noopener">latest releases page</a> and pick your file there.
        </div>
      <noscript>
        <div style="margin: 8px 0 0 0; color: var(--muted); font-size: 10px;">
          <strong>Note:</strong> Direct download buttons use JavaScript. If disabled, please use the releases page link above.
        </div>
      </noscript>
    </section>

    <section class="card grid">
      <div>
        <h2>What it does</h2>
        <ul>
          <li>Play videos and record native speaker descriptions of each.</li>
          <li>Keep simple project info in a built‑in metadata editor.</li>
          <li>Export all your recordings (and metadata) in one step.</li>
          <li>Open recordings in Ocenaudio for trimming, normalizing, and fine‑tuning.</li>
          <li>Combine all WAV files into a single audio file with subtle click markers between items.</li>
          <li>Choose your language for the interface.</li>
        </ul>
      </div>
      <div>
        <h2>Screenshots</h2>
        <div class="carousel" id="screenshotCarousel">
          <button class="carousel-arrow carousel-arrow-left" aria-label="Previous screenshot" tabindex="0">
            <svg width="18" height="64" viewBox="0 0 18 64" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:block;margin:auto;">
              <polyline points="12,8 6,32 12,56" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            </svg>
          </button>
          <div class="carousel-track">
            <div class="carousel-slide">
              <img src="./assets/screenshots/screenshot_videos.png" alt="Default Video Annotation view" />
              <div class="carousel-caption">Default Video Annotation view: Record descriptions of videos one at a time.</div>
            </div>
            <div class="carousel-slide">
              <img src="./assets/screenshots/screenshot_images.png" alt="Image Annotation view" />
              <div class="carousel-caption">Image Annotation view: Describe still images in the same folder.</div>
            </div>
            <div class="carousel-slide">
              <img src="./assets/screenshots/screenshot_combined_wav.png" alt="Export as single WAV file" />
              <div class="carousel-caption">Export all recordings as a single WAV file for easy import into SayMore or ELAN. Auto-generated clicks visibly and audibly mark the boundaries between clips.</div>
            </div>
            <div class="carousel-slide">
              <img src="./assets/screenshots/screenshot_ocenaudio.png" alt="Open in OcenAudio editor" />
              <div class="carousel-caption">Open all recordings in OcenAudio for trimming, normalization, and further editing.</div>
            </div>
          </div>
          <div class="carousel-dots"></div>
          <button class="carousel-arrow carousel-arrow-right" aria-label="Next screenshot" tabindex="0">
            <svg width="18" height="64" viewBox="0 0 18 64" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:block;margin:auto;">
              <polyline points="6,8 12,32 6,56" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            </svg>
          </button>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Quick start</h2>
      <ol>
        <li>Prepare a folder with your video files (MP4, MOV, AVI, MKV, etc.).</li>
        <li>Open the app and click “Select Folder”. Pick your video folder.</li>
        <li>Select a video from the list to preview the first frame.</li>
        <li>Press “Record Audio” to capture your native-speaker description; press again to stop and save. The app saves a WAV with the same name as the video.</li>
        <li>Use “Export Recorded Data” to copy all WAVs and metadata.txt to a folder of your choice.</li>
      </ol>
    </section>

    <section class="card grid">
      <div>
        <h2>Install on Windows</h2>
        <ul>
          <li>Download the <strong>.exe</strong> above.</li>
          <li>Double‑click to run. If SmartScreen appears, choose “More info” → “Run anyway”.</li>
          <li>No separate install is required.</li>
        </ul>
      </div>
      <div>
        <h2>Install on macOS</h2>
        <ul>
          <li>Download the <strong>.dmg</strong> above and open it.</li>
          <li>Drag “Video Annotation Tool.app” into Applications.</li>
          <li>On first launch, you may need to allow it in System Settings → Privacy & Security.</li>
        </ul>
      </div>
    </section>

    <section class="card">
      <h2>Working in a project</h2>
      <ul>
        <li><strong>Folder display:</strong> The app shows the current project folder at the top; hover to see the full path.</li>
        <li><strong>Video preview & playback:</strong> Pick a video to preview the first frame and play/stop as needed.</li>
        <li><strong>Audio notes:</strong> Record a short WAV per video. If a file exists, the app will ask before overwriting.</li>
        <li><strong>Metadata:</strong> Edit project info in the side panel; it’s saved to <code>metadata.txt</code> in your folder.</li>
        <li><strong>Open in Ocenaudio:</strong> Launch all WAVs in Ocenaudio for further editing.</li>
        <li><strong>Export / Import:</strong> Export all WAVs + metadata, or import WAVs that match your video names.</li>
        <li><strong>Join WAVs:</strong> Make a single WAV of all items, with subtle click separators between each clip.</li>
        <li><strong>Languages:</strong> Use the top dropdown to switch the interface language.</li>
      </ul>
    </section>

    <section class="card">
      <h2>Troubleshooting</h2>
      <ul>
        <li><strong>Microphone access:</strong> If recording is silent or fails, check your OS microphone permissions for the app.</li>
        <li><strong>macOS cannot open the app:</strong> Right‑click the app → Open, or allow it in Privacy & Security and try again.</li>
        <li><strong>No videos listed:</strong> Confirm the folder contains supported video files (e.g., .mp4, .mov).</li>
        <li><strong>Need help?</strong> Visit the <a href="https://github.com/rulingAnts/videoannotationtool/issues" target="_blank" rel="noopener">issue tracker</a>.</li>
      </ul>
    </section>

    <p class="footer">
      Latest release: <a href="https://github.com/rulingAnts/videoannotationtool/releases/latest" target="_blank" rel="noopener">GitHub → Releases</a>
      · Source code: <a href="https://github.com/rulingAnts/videoannotationtool" target="_blank" rel="noopener">GitHub</a>
    </p>
  </div>
  <script>
    (function(){
      const owner = 'rulingAnts';
      const repo = 'videoannotationtool';
      const api = `https://api.github.com/repos/${owner}/${repo}/releases/latest`;
      const winInstaller = document.getElementById('winInstaller');
      const winPortable = document.getElementById('winPortable');
      const macA = document.getElementById('macLink');
      const ver = document.getElementById('latestVersion');

      fetch(api, { headers: { 'Accept': 'application/vnd.github+json' }})
        .then(r => {
          if (!r.ok) throw new Error('HTTP '+r.status);
          return r.json();
        })
        .then(data => {
          const tag = data.tag_name || data.name || '';
          if (ver) ver.textContent = tag ? tag : 'latest';
          const assets = Array.isArray(data.assets) ? data.assets : [];
          // Find installer and portable .exe
          const isInstaller = (n) => /setup|installer/i.test(n);
          const isPortable = (n) => n.toLowerCase().endsWith('.exe') && !isInstaller(n);
          const installer = assets.find(a => a && a.browser_download_url && a.name && isInstaller(a.name));
          const portable = assets.find(a => a && a.browser_download_url && a.name && isPortable(a.name));
          const dmg = assets.find(a => a && a.browser_download_url && a.name && a.name.toLowerCase().endsWith('.dmg'));
          if (installer && winInstaller) {
            winInstaller.href = installer.browser_download_url;
            winInstaller.removeAttribute('target');
            winInstaller.removeAttribute('rel');
          }
          if (portable && winPortable) {
            winPortable.href = portable.browser_download_url;
            winPortable.removeAttribute('target');
            winPortable.removeAttribute('rel');
          }
          if (dmg && macA) {
            macA.href = dmg.browser_download_url;
            macA.removeAttribute('target');
            macA.removeAttribute('rel');
          }
        })
        .catch(err => {
          if (ver) ver.textContent = 'latest';
          console.warn('Failed to fetch latest release info:', err);
        });
    })();
  </script>
  <script>
    // Carousel logic with arrow buttons and swipe/drag
    (function() {
      const carousel = document.getElementById('screenshotCarousel');
      if (!carousel) return;
      const track = carousel.querySelector('.carousel-track');
      const slides = Array.from(carousel.querySelectorAll('.carousel-slide'));
      const dotsContainer = carousel.querySelector('.carousel-dots');
      const leftBtn = carousel.querySelector('.carousel-arrow-left');
      const rightBtn = carousel.querySelector('.carousel-arrow-right');
      let current = 0;
      let timer = null;
      let isDragging = false, startX = 0, currentX = 0, dragDelta = 0;
      function goTo(idx) {
        current = (idx + slides.length) % slides.length;
        track.style.transform = `translateX(-${current * 100}%)`;
        dotsContainer.querySelectorAll('button').forEach((b,i) => b.classList.toggle('active', i===current));
      }
      function next() { goTo(current+1); }
      function prev() { goTo(current-1); }
      // Dots
      slides.forEach((_,i) => {
        const btn = document.createElement('button');
        btn.setAttribute('aria-label', `Show screenshot ${i+1}`);
        btn.onclick = () => { goTo(i); resetTimer(); };
        dotsContainer.appendChild(btn);
      });
      goTo(0);
      // Auto-swipe
      function resetTimer() {
        if (timer) clearInterval(timer);
        timer = setInterval(next, 4200);
      }
      resetTimer();
      // Pause on hover
      carousel.addEventListener('mouseenter', ()=>{ if (timer) clearInterval(timer); });
      carousel.addEventListener('mouseleave', resetTimer);
      // Keyboard support
      carousel.tabIndex = 0;
      carousel.addEventListener('keydown', e => {
        if (e.key === 'ArrowLeft') { prev(); resetTimer(); }
        if (e.key === 'ArrowRight') { next(); resetTimer(); }
      });
      // Arrow buttons
      if (leftBtn) leftBtn.onclick = () => { prev(); resetTimer(); };
      if (rightBtn) rightBtn.onclick = () => { next(); resetTimer(); };
      // Touch/drag support
      function onDragStart(e) {
        isDragging = true;
        startX = (e.touches ? e.touches[0].clientX : e.clientX);
        currentX = startX;
        track.style.transition = 'none';
      }
      function onDragMove(e) {
        if (!isDragging) return;
        currentX = (e.touches ? e.touches[0].clientX : e.clientX);
        dragDelta = currentX - startX;
        track.style.transform = `translateX(${-current * 100 + (dragDelta/track.offsetWidth)*100}%)`;
      }
      function onDragEnd() {
        if (!isDragging) return;
        track.style.transition = '';
        if (Math.abs(dragDelta) > track.offsetWidth/6) {
          if (dragDelta < 0) next();
          else prev();
        } else {
          goTo(current);
        }
        isDragging = false;
        dragDelta = 0;
        resetTimer();
      }
      track.addEventListener('mousedown', onDragStart);
      track.addEventListener('touchstart', onDragStart, {passive:true});
      window.addEventListener('mousemove', onDragMove);
      window.addEventListener('touchmove', onDragMove, {passive:true});
      window.addEventListener('mouseup', onDragEnd);
      window.addEventListener('touchend', onDragEnd);
      // Prevent image dragging
      slides.forEach(slide => {
        slide.querySelector('img').ondragstart = e => e.preventDefault();
      });
    })();
  </script>
</body>
</html>
